!function(p){"use strict";const d={TITLE:"title",SELECT:"select",COLLAPSE:"collapse",LABEL:"label",COLOR:"color"},i={data:null,icon:'<svg viewBox="0 0 24 24"><path d="M 1.786 21 L 22.214 21 C 22.648 21 23 20.648 23 20.214 L 23 5.786 C 23 5.352 22.648 5 22.214 5 L 11 5 L 10.176 3.361 C 10.079 3.167 9.824 3.009 9.607 3.009 L 1.786 3.001 C 1.352 3 1 3.352 1 3.786 L 1 20.214 C 1 20.648 1.352 21 1.786 21 Z " fill="currentColor" style="filter:invert(0.05) brightness(0.6)"/><path d="M 1,7 V 20.159624 C 1,20.624144 1.3511577,21 1.7851562,21 H 22.214844 C 22.648841,21 23,20.624144 23,20.159624 V 7.08571 Z " fill="currentColor" style="filter:invert(0.05)"/><path d="m 7.5,12.5 v 3 h 9 v -3 z" fill="currentColor" style="filter:invert(0.05) brightness(.7)" class="folders-tree-icon-minus" /><path d="m 10.5,9.5 v 3 h -3 v 3 h 3 v 3 h 3 v -3 h 3 v -3 h -3 v -3 z" fill="currentColor" style="filter:invert(0.05) brightness(.7)" class="folders-tree-icon-plus" /></svg>',callback:{loading:null,move:null,collapse:null}},n={id:null,color:null,title:null,state:{selected:!1,collapsed:!1},items:[]},l={extend:function(i){i=i||{};for(let t=1;t<arguments.length;t++){let e=arguments[t];if(e)for(var n in e)e.hasOwnProperty(n)&&("object"==typeof e[n]&&null!=e[n]?e[n]instanceof Array?i[n]=e[n].slice(0):i[n]=l.extend(i[n],e[n]):i[n]=e[n])}return i},extendTreeCfg:function(e){const t=l.extend({},i,e);return delete t.data,t},extendTreeItemCfg:function(e){const t=l.extend({},n,e);return null==t.id&&(t.id=l.uuid()),t.state.selected=!1,t.items=[],t},isArray:function(e){return Array.isArray(e)},isString:function(e){return"string"==typeof e},uuid:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}},s=function(){const m=new WeakMap;function e(e,t){m.set(this,{$container:null,dragdrop:{enabled:!0,item:null,active:{flag:!1,x:0,y:0,offset:10},$ghost:null,$target:null,type:null},select:{list:[]},config:null,data:[],ready:!1}),this._init(e,t)}return e.prototype={get VERSION(){return"1.0.0"},_init:function(e,t){const i=m.get(this);i.$container=p(e),i.$container.length?(i.config=l.extendTreeCfg(t),i.ready=!1,this._create(t?t.data:null)):console.error("Tree: can't find the tree container")},_create:function(e){this._buildDOM(),this._bind(),this._ready(e)},_buildDOM:function(){const e=m.get(this);e.$container.addClass("folders-tree").attr({tabindex:0}),e.dragdrop.$ghost=p("<div>").addClass("folders-tree-drag-ghost");var t=p("<div>").addClass("folders-tree-nodes");e.$container.append(t)},_bind:function(){const e=m.get(this);e._onToggleClick=this._onToggleClick.bind(this),e._onItemClick=this._onItemClick.bind(this),e._onKeyDown=this._onKeyDown.bind(this),e._onItemMouseDown=this._onItemMouseDown.bind(this),e._onItemMouseEnter=this._onItemMouseEnter.bind(this),e._onItemMouseLeave=this._onItemMouseLeave.bind(this),e._onItemMouseMove=this._onItemMouseMove.bind(this),e._onItemMouseUp=this._onItemMouseUp.bind(this),e.$container.on("keydown",e._onKeyDown),e.$container.on("click",".folders-tree-icon",e._onToggleClick),e.$container.on("click",".folders-tree-item",e._onItemClick),e.$container.on("mousedown",".folders-tree-item",e._onItemMouseDown)},_loading:function(e){const t=m.get(this);t.config.callback.loading&&"function"==typeof t.config.callback.loading&&t.config.callback.loading.call(this,e)},_ready:function(e){const t=m.get(this);for(var i in t.$container.addClass("folders-tree-ready"),this._loading(!0),e)this._addItem(e[i]);this._loading(!1)},_getData:function(){return m.get(this).data},_getFlatData:function(){var e=m.get(this);const r=[];return function e(t,i,n){for(var s in t)s=t[s],r.push({id:s.id,color:s.color,title:s.title,parent:i,level:n,collapsed:s.state.collapsed}),e(s.items,s.id,n+1)}(e.data,null,0),r.length?r:null},_getRootItems:function(){var e,t=m.get(this);const i=[];for(e in t.data){var n=t.data[e];i.push({id:n.id,color:n.color,title:n.title,parent:null,level:0,collapsed:n.state.collapsed})}return i.length?i:null},_filter:function(r){const e=m.get(this);r?(e.$container.find(".folders-tree-node.folders-hidden").removeClass("folders-hidden"),e.$container.find(".folders-tree-title").each((e,t)=>{const i=p(t),n=(t=i.text(),i.parent()),s=n.parent();!function(t){if(r){let e=r.replace(/[.+^${}()|[\]\\]/g,"\\$&");e=e.includes("*")||e.includes("?")?e:"*"+e+"*";const i=new RegExp(`^${e.replace(/\*/g,".*").replace(/\?/g,".")}$`,"i");return i.test(t)}}(t)?(i.removeClass("folders-bold"),s.addClass("folders-hidden")):(i.addClass("folders-bold"),s.parents(".folders-tree-node").removeClass("folders-hidden"))})):(e.$container.find(".folders-tree-node.folders-hidden").removeClass("folders-hidden"),e.$container.find(".folders-tree-title.folders-bold").removeClass("folders-bold"))},_addItemElement:function(e,t){const i=m.get(this);let n=null;if(t){const a=i.$container.find(`[data-id='${t.id}']`);a.length&&!(n=p(a.parent().find(".folders-tree-nodes").get(0))).length&&(n=p("<div>").addClass("folders-tree-nodes"),a.addClass("folders-tree-has-children"),a.parent().append(n))}else n=p(i.$container.find(".folders-tree-nodes").get(0)),i.$container.addClass("folders-tree-has-children");if(n){const o=p("<div>").addClass("folders-tree-node"),l=p("<div>").addClass("folders-tree-item").attr({"data-id":e.id});var t=p("<div>").addClass("folders-tree-icon").append(i.config.icon),s=p("<div>").addClass("folders-tree-title"),r=p("<div>").addClass("folders-tree-label");n.append(o.append(l.append(t,s,r))),this._updateItemElement(e,[d.TITLE,d.SELECT,d.COLLAPSE,d.LABEL,d.COLOR]),e.state.selected&&i.select.list.push(e)}},_removeItemElement:function(e,t){const i=m.get(this),n=i.$container.find(`[data-id='${e.id}']`);if(n.parent().remove(),e.state.selected&&i.select.list.splice(i.select.list.indexOf(e),1),t&&0===t.items.length){const s=i.$container.find(`[data-id='${t.id}']`),r=p(s.parent().find(".folders-tree-nodes").get(0));s.removeClass("folders-tree-has-children"),r.remove()}},_updateItemElement:function(e,t){const i=m.get(this),n=e?i.$container.find(`[data-id='${e.id}']`):null;if(n.length)for(var s in t=l.isString(t)?[t]:t)switch(t[s]){case d.TITLE:n.find(".folders-tree-title").text(e.title);break;case d.SELECT:n.toggleClass("folders-tree-selected",e.state.selected);break;case d.COLLAPSE:n.toggleClass("folders-tree-collapsed",e.state.collapsed);break;case d.LABEL:n.find(".folders-tree-label").toggleClass("folders-tree-active",!!e.count).text(e.count);break;case d.COLOR:n.find(".folders-tree-icon").css({color:e.color||""})}},_addItem:function(e,t){const a=m.get(this),o=this;return function e(t,i){if(t&&t.id&&o._getItem(t.id))return null;var n=l.extendTreeItemCfg(t);const s=o._getItem(i);if((s?s.items:a.data).push(n),o._addItemElement(n,s),t)for(const r in t.items)e(t.items[r],n.id);return n}(e,t)},_getItem:function(e){return function t(i,n){let s=null;if(i)for(let e=0;e<i.length&&(s=i[e]).id!==n&&!(s=t(s.items,n));e++);return s}(m.get(this).data,e)},_getParentItem:function(e){return function t(i,n,s){let r=null;if(i)for(let e=0;e<i.length;e++){if((r=i[e]).id===n){r=s;break}if(r=t(r.items,n,r))break}return r}(m.get(this).data,e,null)},_getPrevItem:function(e,a){var t=m.get(this);const o=[];return function t(i,n){let s=null;if(i)for(let e=0;e<i.length;e++){if((s=i[e]).id===n){var r;if(0<e)for(s=i[e-1];(!s.state.collapsed||a)&&s.items.length;)s=s.items[s.items.length-1];else s=null,o.length&&(r=o[o.length-1],s=r.items[r.index]);break}if(o.push({index:e,items:i}),s=t(s.items,n,s),o.pop(),s)break}return s}(t.data,e)},_getNextItem:function(e,a){var t=m.get(this);const o=[];return function t(i,n){let s=null;if(i)for(let e=0;e<i.length;e++){if((s=i[e]).id===n){if(s.state.collapsed&&!a||!s.items.length)if(e<i.length-1)s=i[e+1];else for(s=null,e=o.length;e--;){var r=o[e];if(r.index<r.items.length-1){s=r.items[r.index+1];break}}else s=s.items.length?s.items[0]:null;break}if(o.push({index:e,items:i}),s=t(s.items,n,s),o.pop(),s)break}return s}(t.data,e)},_getSelectedItems:function(){return m.get(this).select.list},_moveItem:function(t,i,e){const n=m.get(this);var s=this._getItem(t),r=this._getItem(i);if(null!=s&&null!=r){this._loading(!0);const o=n.$container.find(`[data-id='${s.id}']`),l=o.parent(),d=n.$container.find(`[data-id='${r.id}']`),c=d.parent();var a=s?this._getParentItem(s.id):null,r=r?this._getParentItem(r.id):null;const f=a?a.items:n.data,g=r?r.items:n.data;for(let e=0;e<f.length;e++)if(f[e].id===t){f.splice(e,1);break}if(l.detach(),0===f.length&&a){const u=n.$container.find(`[data-id='${a.id}']`),h=p(u.parent().find(".folders-tree-nodes").get(0));u.removeClass("folders-tree-has-children"),h.remove()}switch(e){case"inside":for(let t=0;t<g.length;t++)if(g[t].id===i){g[t].items.push(s);let e=p(d.parent().find(".folders-tree-nodes").get(0));e.length||(e=p("<div>").addClass("folders-tree-nodes"),d.addClass("folders-tree-has-children"),d.parent().append(e)),e.append(l);break}break;case"before":for(let e=0;e<g.length;e++)if(g[e].id===i){g.splice(e,0,s);break}c.before(l);break;case"after":for(let e=0;e<g.length;e++)if(g[e].id===i){g.splice(e+1,0,s);break}c.after(l)}this._loading(!1)}},_removeItem:function(e){var t=m.get(this);const a=this;return function i(e,n){let s=null;if(n)for(let t=0;t<n.length;t++){if(s=n[t],n[t].id===e){let e=s.items.length;for(;e--;)i(s.items[e].id,s.items);var r=a._getParentItem(s.id);n.splice(t,1),a._removeItemElement(s,r);break}if(s=i(e,n[t].items))break}return s}(e,t.data)},_collapseItem:function(e,t){const i=m.get(this),n=this._getItem(e);if(n){let e=!1;void 0===t?(e=!0,n.state.collapsed=!n.state.collapsed):n.state.collapsed!==t&&(e=!0,n.state.collapsed=t),e&&(this._updateItemElement(n,d.COLLAPSE),i.config.callback.collapse&&"function"==typeof i.config.callback.collapse&&i.config.callback.collapse.call(this,n))}},_selectItem:function(e,t){const i=m.get(this),n=this._getItem(e);if(n){let e=!1;void 0===t?(e=!0,n.state.selected=!n.state.selected):n.state.selected!==t&&(e=!0,n.state.selected=t),e&&(this._updateItemElement(n,d.SELECT),n.state.selected&&-1===i.select.list.indexOf(n)?i.select.list.push(n):i.select.list.splice(i.select.list.indexOf(n),1))}},_selectItemRange:function(e,t){var i=m.get(this),n=[];if(e&&t&&e!==t){!function t(i,n,s,r){if(s)for(let e=0;e<s.length;e++){var a=s[e];if(a.id===i){if(r.push(a),1<r.length)return 1}else if(a.id===n){if(r.push(a),1<r.length)return 1}else r.length&&r.push(a);if(a.items.length&&!a.state.collapsed&&t(i,n,a.items,r))return 1}}(e,t,i.data,n);for(let e=0;e<n.length;e++)n[e].state.selected||this._selectItem(n[e].id,!0,!0)}else t&&this._selectItem(t,!0)},_clearSelection:function(){const i=m.get(this);for(let t=0;t<i.select.list.length;t++){let e=i.select.list[t];e.state.selected=!1,this._updateItemElement(e,d.SELECT)}i.select.list=[]},_getDragDropType:function(e,t){return e=e.getBoundingClientRect(),(t=t-window.scrollY-e.top)<e.height/4?"before":t>3*e.height/4?"after":"inside"},_onKeyDown:function(e){const t=m.get(this);var i=t.select.list[t.select.list.length-1];if(document.activeElement===t.$container.get(0)&&i){switch(e.keyCode){case 38:var n=this._getPrevItem(i.id,!1);n&&(this._clearSelection(),this._selectItem(n.id,!0));break;case 40:(n=this._getNextItem(i.id,!1))&&(this._clearSelection(),this._selectItem(n.id,!0));break;case 37:this._collapseItem(i.id,!0);break;case 39:this._collapseItem(i.id,!1)}e.preventDefault()}},_onToggleClick:function(e){e.preventDefault(),e.stopImmediatePropagation();const t=p(e.currentTarget).parent();e=t?t.attr("data-id"):null,this._collapseItem(e)},_onItemClick:function(e){const t=p(e.currentTarget);var i=t?t.attr("data-id"):null;e.shiftKey||e.ctrlKey?e.ctrlKey?this._selectItem(i):e.shiftKey&&(e=(e=m.get(this)).select.list.length?e.select.list[e.select.list.length-1].id:null,this._selectItemRange(e,i)):this._clearSelection()},_onItemMouseDown:function(e){if(1===e.which&&!e.shiftKey&&!e.ctrlKey){e.stopImmediatePropagation();const s=m.get(this),r=p(e.currentTarget);var t=r.attr("data-id"),t=this._getItem(t),i=(s.dragdrop.item=t,p("<div>").addClass("folders-tree-icon")),t=p("<div>").addClass("folders-tree-title").text(t.title),n=p("<div>").addClass("folders-tree-label").text(s.select.list.length);s.dragdrop.active.flag=!1,s.dragdrop.active.x=e.pageX,s.dragdrop.active.y=e.pageY,s.dragdrop.$ghost.empty().append(i,t,n).appendTo("body"),s.$container.addClass("folders-tree-dragging"),s.$container.on("mouseenter",".folders-tree-item",s._onItemMouseEnter),s.$container.on("mouseleave",".folders-tree-item",s._onItemMouseLeave),p(window).on("mousemove",s._onItemMouseMove),p(window).on("mouseup",s._onItemMouseUp)}},_onItemMouseEnter:function(e){const t=m.get(this);t.dragdrop.$target=p(e.currentTarget),t.dragdrop.$target&&t.dragdrop.$target.removeClass("folders-tree-before folders-tree-inside folders-tree-after")},_onItemMouseLeave:function(){const e=m.get(this);e.dragdrop.$target&&e.dragdrop.$target.removeClass("folders-tree-before folders-tree-inside folders-tree-after"),e.dragdrop.$target=null},_onItemMouseMove:function(e){const t=m.get(this);var i;t.dragdrop.active.flag?(t.dragdrop.$ghost.addClass("folders-tree-active").css({top:e.clientY+5+"px",left:e.clientX+5+"px"}),t.dragdrop.$target&&(i=this._getDragDropType(t.dragdrop.$target.get(0),e.pageY),t.dragdrop.type!==i&&(t.dragdrop.$target.removeClass("folders-tree-before folders-tree-inside folders-tree-after").addClass("folders-tree-"+i),t.dragdrop.type=i))):(t.dragdrop.active.flag=Math.abs(t.dragdrop.active.x-e.pageX)>t.dragdrop.active.offset||Math.abs(t.dragdrop.active.y-e.pageY)>t.dragdrop.active.offset,t.dragdrop.active.flag&&((i=t.dragdrop.item)&&!i.state.selected&&(this._clearSelection(),this._selectItem(i.id)),t.dragdrop.$ghost.find(".folders-tree-label").text(t.select.list.length)))},_onItemMouseUp:function(){const e=m.get(this);if(e.dragdrop.$ghost.empty().css({top:null,left:null}).removeClass("folders-tree-active").detach(),e.$container.removeClass("folders-tree-dragging"),e.dragdrop.active.flag&&e.dragdrop.$target){var t=[],i=e.dragdrop.$target?e.dragdrop.$target.attr("data-id"):null,n=e.dragdrop.type;if(e.dragdrop.$ghost.detach().empty(),e.dragdrop.$target&&e.dragdrop.$target.removeClass("folders-tree-before folders-tree-inside folders-tree-after"),e.dragdrop.$target=null,e.dragdrop.type=null,e.dragdrop.item=null,e.$container.removeClass("folders-tree-dragging"),function t(i,n,s){if(i)for(let e=0;e<i.length;e++){var r=i[e];if(r.state.selected){let i=!0;for(let t=0;t<n.length;t++)for(let e=0;e<s.length;e++)if(s[e].id===n[t].id){i=!1;break}i&&s.push(r)}r.items.length&&(n.push(r),t(r.items,n,s),n.pop())}}(e.data,[],t),function t(i,n){for(let e=0;e<i.length;e++){if(i[e].id===n)return;if(i[e].items.length&&!t(i[e].items,n))return}return 1}(t,i)){const o=[];for(let e=0;e<t.length;e++)o.push(t[e].id);function s(t,i,n){if("after"===n){let e=t.length;for(;e--;)this._moveItem(t[e],i,n)}else for(let e=0;e<t.length;e++)this._moveItem(t[e],i,n)}if(e.config.callback.move&&"function"==typeof e.config.callback.move){var r="inside"===n?this._getItem(i):this._getParentItem(i),a=r?r.id:null;const l=r?r.items:e.data;r=l.map(e=>e.id),e.config.callback.move.call(this,o,a,i,r,n,s)}else s.call(this,o,i,n)}}e.$container.off("mouseenter",".folders-tree-item",e._onItemMouseEnter),e.$container.off("mouseleave",".folders-tree-item",e._onItemMouseLeave),p(window).off("mousemove",e._onItemMouseMove),p(window).off("mouseup",e._onItemMouseUp)},getIcon:function(){return m.get(this).config.icon},getData:function(){return this._getData()},hasItems:function(){var e=m.get(this);return e.data&&0<e.data.length},getFlatData:function(){return this._getFlatData()},getRootItems:function(){return this._getRootItems()},getItem:function(e){return this._getItem(e)},getParentItem:function(e){return this._getParentItem(e)},selectItem:function(e,t){this._selectItem(e,t)},getSelectedItems:function(){return this._getSelectedItems()},clearSelection:function(){this._clearSelection()},filter:function(e){this._filter(e)},addItem:function(e,t){return this._addItem(e,t)},collapseItem:function(e,t){return this._collapseItem(e,t)},removeItem:function(e){this._removeItem(e)},updateItemTitle:function(e,t){const i=this._getItem(e);i&&(i.title=t,this._updateItemElement(i,d.TITLE))},updateItemColor:function(e,t){const i=this._getItem(e);i&&(i.color=t,this._updateItemElement(i,d.COLOR))},updateItemLabel:function(e,t){const i=this._getItem(e);i&&(i.count=parseInt(t,10),this._updateItemElement(i,d.LABEL))},toggleDragDrop:function(e){const t=m.get(this);e?(t.dragdrop.enabled||t.$container.on("mousedown",".folders-tree-item",t._onItemMouseDown),t.dragdrop.enabled=!0):(t.dragdrop.enabled&&t.$container.off("mousedown",".folders-tree-item",t._onItemMouseDown),t.dragdrop.enabled=!1)}},e}();window.IFOLDERS=window.IFOLDERS||{},window.IFOLDERS.PLUGINS=window.IFOLDERS.PLUGINS||{},window.IFOLDERS.PLUGINS.TREE=function(e,t){return new s(e,t)}}(jQuery);